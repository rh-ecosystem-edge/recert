{"replicas":1,"selector":{"matchLabels":{"apiserver":"true","app":"openshift-oauth-apiserver"}},"template":{"metadata":{"name":"openshift-oauth-apiserver","creationTimestamp":null,"labels":{"apiserver":"true","app":"openshift-oauth-apiserver","oauth-apiserver-anti-affinity":"true","revision":"${REVISION}"},"annotations":{"operator.openshift.io/dep-openshift-oauth-apiserver.etcd-client.secret":"${ETCD_CLIENT_HASH}","operator.openshift.io/dep-openshift-oauth-apiserver.etcd-serving-ca.configmap":"${ETCD_SERVING_CA_HASH}","target.workload.openshift.io/management":"{\"effect\": \"PreferredDuringScheduling\"}"}},"spec":{"volumes":[{"name":"audit-policies","configMap":{"name":"audit-${REVISION}"}},{"name":"etcd-client","secret":{"secretName":"etcd-client"}},{"name":"etcd-serving-ca","configMap":{"name":"etcd-serving-ca"}},{"name":"serving-cert","secret":{"secretName":"serving-cert"}},{"name":"trusted-ca-bundle","configMap":{"name":"trusted-ca-bundle","items":[{"key":"ca-bundle.crt","path":"tls-ca-bundle.pem"}],"optional":true}},{"name":"encryption-config","secret":{"secretName":"encryption-config-${REVISION}","optional":true}},{"name":"audit-dir","hostPath":{"path":"/var/log/oauth-apiserver"}}],"initContainers":[{"name":"fix-audit-permissions","image":"${IMAGE}","command":["sh","-c","chmod 0700 /var/log/oauth-apiserver \u0026\u0026 touch /var/log/oauth-apiserver/audit.log \u0026\u0026 chmod 0600 /var/log/oauth-apiserver/*"],"resources":{"requests":{"cpu":"15m","memory":"50Mi"}},"volumeMounts":[{"name":"audit-dir","mountPath":"/var/log/oauth-apiserver"}],"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true,"runAsUser":0}}],"containers":[{"name":"oauth-apiserver","image":"${IMAGE}","command":["/bin/bash","-ec"],"args":["if [ -s /var/run/configmaps/trusted-ca-bundle/tls-ca-bundle.pem ]; then\n  echo \"Copying system trust bundle\"\n  cp -f /var/run/configmaps/trusted-ca-bundle/tls-ca-bundle.pem /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem\nfi\nexec oauth-apiserver start \\\n  --secure-port=8443 \\\n  --audit-log-path=/var/log/oauth-apiserver/audit.log \\\n  --audit-log-format=json \\\n  --audit-log-maxsize=100 \\\n  --audit-log-maxbackup=10 \\\n  --audit-policy-file=/var/run/configmaps/audit/policy.yaml \\\n  --etcd-cafile=/var/run/configmaps/etcd-serving-ca/ca-bundle.crt \\\n  --etcd-keyfile=/var/run/secrets/etcd-client/tls.key \\\n  --etcd-certfile=/var/run/secrets/etcd-client/tls.crt \\\n  --shutdown-delay-duration=15s \\\n  --shutdown-send-retry-after=true \\\n  --tls-private-key-file=/var/run/secrets/serving-cert/tls.key \\\n  --tls-cert-file=/var/run/secrets/serving-cert/tls.crt \\\n  --enable-priority-and-fairness=false \\\n  ${FLAGS}\n"],"ports":[{"containerPort":8443}],"env":[{"name":"POD_NAME","valueFrom":{"fieldRef":{"fieldPath":"metadata.name"}}},{"name":"POD_NAMESPACE","valueFrom":{"fieldRef":{"fieldPath":"metadata.namespace"}}}],"resources":{"requests":{"cpu":"150m","memory":"200Mi"}},"volumeMounts":[{"name":"audit-policies","mountPath":"/var/run/configmaps/audit"},{"name":"etcd-client","mountPath":"/var/run/secrets/etcd-client"},{"name":"etcd-serving-ca","mountPath":"/var/run/configmaps/etcd-serving-ca"},{"name":"trusted-ca-bundle","mountPath":"/var/run/configmaps/trusted-ca-bundle"},{"name":"serving-cert","mountPath":"/var/run/secrets/serving-cert"},{"name":"encryption-config","mountPath":"/var/run/secrets/encryption-config"},{"name":"audit-dir","mountPath":"/var/log/oauth-apiserver"}],"livenessProbe":{"httpGet":{"path":"healthz","port":8443,"scheme":"HTTPS"},"timeoutSeconds":10,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"readinessProbe":{"httpGet":{"path":"readyz","port":8443,"scheme":"HTTPS"},"timeoutSeconds":10,"periodSeconds":5,"successThreshold":1,"failureThreshold":1},"startupProbe":{"httpGet":{"path":"healthz","port":8443,"scheme":"HTTPS"},"timeoutSeconds":10,"periodSeconds":5,"successThreshold":1,"failureThreshold":30},"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true,"runAsUser":0}}],"terminationGracePeriodSeconds":90,"nodeSelector":{"node-role.kubernetes.io/master":""},"serviceAccountName":"oauth-apiserver-sa","affinity":{"podAntiAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":[{"labelSelector":{"matchLabels":{"apiserver":"true","app":"openshift-oauth-apiserver","oauth-apiserver-anti-affinity":"true"}},"topologyKey":"kubernetes.io/hostname"}]}},"tolerations":[{"key":"node-role.kubernetes.io/master","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":120},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":120}],"priorityClassName":"system-node-critical"}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":1,"maxSurge":0}}}