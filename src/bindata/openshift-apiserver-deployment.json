{"replicas":1,"selector":{"matchLabels":{"apiserver":"true","app":"openshift-apiserver-a"}},"template":{"metadata":{"name":"openshift-apiserver","creationTimestamp":null,"labels":{"apiserver":"true","app":"openshift-apiserver-a","openshift-apiserver-anti-affinity":"true","revision":"${REVISION}"},"annotations":{"openshift.io/required-scc":"privileged","operator.openshift.io/dep-desired.generation":"${DESIRED_GENERATION}","operator.openshift.io/dep-openshift-apiserver.config.configmap":"${CONFIG_HASH}","operator.openshift.io/dep-openshift-apiserver.etcd-client.secret":"${ETCD_CLIENT_HASH}","operator.openshift.io/dep-openshift-apiserver.etcd-serving-ca.configmap":"${ETCD_SERVING_CA_HASH}","operator.openshift.io/dep-openshift-apiserver.image-import-ca.configmap":"${IMAGE_IMPORT_CA_HASH}","operator.openshift.io/dep-openshift-apiserver.trusted-ca-bundle.configmap":"${TRUSTED_CA_BUNDLE_HASH}","target.workload.openshift.io/management":"{\"effect\": \"PreferredDuringScheduling\"}"}},"spec":{"volumes":[{"name":"node-pullsecrets","hostPath":{"path":"/var/lib/kubelet/","type":"Directory"}},{"name":"config","configMap":{"name":"config"}},{"name":"audit","configMap":{"name":"audit-${REVISION}"}},{"name":"etcd-client","secret":{"secretName":"etcd-client","defaultMode":384}},{"name":"etcd-serving-ca","configMap":{"name":"etcd-serving-ca"}},{"name":"image-import-ca","configMap":{"name":"image-import-ca","optional":true}},{"name":"serving-cert","secret":{"secretName":"serving-cert","defaultMode":384}},{"name":"trusted-ca-bundle","configMap":{"name":"trusted-ca-bundle","items":[{"key":"ca-bundle.crt","path":"tls-ca-bundle.pem"}],"optional":true}},{"name":"encryption-config","secret":{"secretName":"encryption-config-${REVISION}","defaultMode":384,"optional":true}},{"name":"audit-dir","hostPath":{"path":"/var/log/openshift-apiserver"}}],"initContainers":[{"name":"fix-audit-permissions","image":"${IMAGE}","command":["sh","-c","chmod 0700 /var/log/openshift-apiserver \u0026\u0026 touch /var/log/openshift-apiserver/audit.log \u0026\u0026 chmod 0600 /var/log/openshift-apiserver/*"],"resources":{"requests":{"cpu":"15m","memory":"50Mi"}},"volumeMounts":[{"name":"audit-dir","mountPath":"/var/log/openshift-apiserver"}],"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true,"runAsUser":0}}],"containers":[{"name":"openshift-apiserver","image":"${IMAGE}","command":["/bin/bash","-ec"],"args":["if [ -s /var/run/configmaps/trusted-ca-bundle/tls-ca-bundle.pem ]; then\n  echo \"Copying system trust bundle\"\n  cp -f /var/run/configmaps/trusted-ca-bundle/tls-ca-bundle.pem /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem\nfi\nexec openshift-apiserver start --config=/var/run/configmaps/config/config.yaml -v=${VERBOSITY}\n"],"ports":[{"containerPort":8443}],"env":[{"name":"POD_NAME","valueFrom":{"fieldRef":{"fieldPath":"metadata.name"}}},{"name":"POD_NAMESPACE","valueFrom":{"fieldRef":{"fieldPath":"metadata.namespace"}}}],"resources":{"requests":{"cpu":"100m","memory":"200Mi"}},"volumeMounts":[{"name":"node-pullsecrets","readOnly":true,"mountPath":"/var/lib/kubelet/"},{"name":"config","mountPath":"/var/run/configmaps/config"},{"name":"audit","mountPath":"/var/run/configmaps/audit"},{"name":"etcd-client","mountPath":"/var/run/secrets/etcd-client"},{"name":"etcd-serving-ca","mountPath":"/var/run/configmaps/etcd-serving-ca"},{"name":"image-import-ca","mountPath":"/var/run/configmaps/image-import-ca"},{"name":"trusted-ca-bundle","mountPath":"/var/run/configmaps/trusted-ca-bundle"},{"name":"serving-cert","mountPath":"/var/run/secrets/serving-cert"},{"name":"encryption-config","mountPath":"/var/run/secrets/encryption-config"},{"name":"audit-dir","mountPath":"/var/log/openshift-apiserver"}],"livenessProbe":{"httpGet":{"path":"healthz","port":8443,"scheme":"HTTPS"},"timeoutSeconds":10,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"readinessProbe":{"httpGet":{"path":"readyz","port":8443,"scheme":"HTTPS"},"timeoutSeconds":10,"periodSeconds":5,"successThreshold":1,"failureThreshold":1},"startupProbe":{"httpGet":{"path":"healthz","port":8443,"scheme":"HTTPS"},"timeoutSeconds":10,"periodSeconds":5,"successThreshold":1,"failureThreshold":30},"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true,"runAsUser":0,"readOnlyRootFilesystem":false}},{"name":"openshift-apiserver-check-endpoints","image":"${KUBE_APISERVER_OPERATOR_IMAGE}","command":["cluster-kube-apiserver-operator","check-endpoints"],"args":["--listen","0.0.0.0:17698","--namespace","$(POD_NAMESPACE)","--v","2"],"ports":[{"name":"check-endpoints","containerPort":17698,"protocol":"TCP"}],"env":[{"name":"POD_NAME","valueFrom":{"fieldRef":{"fieldPath":"metadata.name"}}},{"name":"POD_NAMESPACE","valueFrom":{"fieldRef":{"fieldPath":"metadata.namespace"}}}],"resources":{"requests":{"cpu":"10m","memory":"50Mi"}},"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent"}],"terminationGracePeriodSeconds":90,"nodeSelector":{"node-role.kubernetes.io/master":""},"serviceAccountName":"openshift-apiserver-sa","affinity":{"podAntiAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":[{"labelSelector":{"matchLabels":{"apiserver":"true","app":"openshift-apiserver-a","openshift-apiserver-anti-affinity":"true"}},"topologyKey":"kubernetes.io/hostname"}]}},"tolerations":[{"key":"node-role.kubernetes.io/master","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":120},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":120}],"priorityClassName":"system-node-critical"}},"strategy":{"type":"RollingUpdate","rollingUpdate":{"maxUnavailable":1,"maxSurge":0}}}